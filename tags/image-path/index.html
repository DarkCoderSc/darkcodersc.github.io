<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=""><meta property="og:title" content="Image Path" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.phrozen.io/tags/image-path/" />
<meta property="og:updated_time" content="2020-04-13T18:35:13+02:00" />
<title>Image Path | Phrozen</title>
<link rel="icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/book.min.63abd10f627a7a06406140610b7ce76d028552de10d790fcb09f332349c39047.css" integrity="sha256-Y6vRD2J6egZAYUBhC3znbQKFUt4Q15D8sJ8zI0nDkEc=">
<script defer src="/en.search.min.75493407ebc34f8246846b0faa4b36cda5c83c14013401d058ad9187af68cee9.js" integrity="sha256-dUk0B&#43;vDT4JGhGsPqks2zaXIPBQBNAHQWK2Rh69ozuk="></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-159560668-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<link rel="alternate" type="application/rss+xml" href="https://www.phrozen.io/tags/image-path/index.xml" title="Phrozen" />
<script src="https://kit.fontawesome.com/8da36c42cc.js" crossorigin="anonymous"></script>
  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/logo.svg" alt="Logo" /></a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
    <span>Microsoft Windows</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/windows/projects/" class="collapsed ">Projects</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/windows/snippets/" class="collapsed ">Snippets</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <span>Linux</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/linux/slae32/" class="collapsed ">SLAE32</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="" target="_blank" rel="noopener"><strong>
        Social Networks
      </strong></a>
  </li>
  
  <li>
    <a href="https://www.linkedin.com/in/jlesueur/" target="_blank" rel="noopener"><i class='fa fa-linkedin'></i>
        Linkedin
      </a>
  </li>
  
  <li>
    <a href="https://www.twitter.com/darkcodersc" target="_blank" rel="noopener"><i class='fa fa-twitter'></i>
        Twitter
      </a>
  </li>
  
  <li>
    <a href="" target="_blank" rel="noopener"><strong>
        Other Stuff
      </strong></a>
  </li>
  
  <li>
    <a href="/disclaimer/disclaimer" target="_blank" rel="noopener">
        Legal
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Image Path</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
 
      </header>

      
      
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-4-getprocessimagefilename/">Get Process Name Method 4 GetProcessImageFileName</a>
    </h2>
    
  <h5>April 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/getprocessimagefilename/">GetProcessImageFileName</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/windows-api/">Windows API</a>
  </div>
  


    <p>This time we will use a quite well known API to get the full process image path GetProcessImageFileName documented here.
Nothing very complex and this technique works from 32bit to 64bit / 64bit to 32bit processes.
// Jean-Pierre LESUEUR (@DarkCoderSc) function PhysicalToVirtualPath(APath : String) : String; var i : integer; ADrive : String; ABuffer : array[0..MAX_PATH-1] of Char; ACandidate : String; begin {$I-} for I := 0 to 25 do begin ADrive := Format('%s:', [Chr(Ord('A') + i)]); /// if (QueryDosDevice(PWideChar(ADrive), ABuffer, MAX_PATH) = 0) then continue; ACandidate := String(ABuffer).
        <a href="/docs/windows/snippets/delphi/get-process-name-method-4-getprocessimagefilename/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-3-ntqueryinformationprocess/">Get Process Name Method 3 NtQueryInformationProcess</a>
    </h2>
    
  <h5>April 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/windows-api/">Windows API</a>, 
      <a href="/tags/ntqueryinformationprocess/">NtQueryInformationProcess</a>
  </div>
  


    <p>Yet another technique to get the full image path of a target process using the NtQueryInformationProcess API documented Here
This technique from 32bit to 64bit / 64bit to 32bit.
// Jean-Pierre LESUEUR (@DarkCoderSc) function PhysicalToVirtualPath(APath : String) : String; var i : integer; ADrive : String; ABuffer : array[0..MAX_PATH-1] of Char; ACandidate : String; begin {$I-} for I := 0 to 25 do begin ADrive := Format('%s:', [Chr(Ord('A') + i)]); /// if (QueryDosDevice(PWideChar(ADrive), ABuffer, MAX_PATH) = 0) then continue; ACandidate := String(ABuffer).
        <a href="/docs/windows/snippets/delphi/get-process-name-method-3-ntqueryinformationprocess/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-2-getmappedfilename/">Get Process Name Method 2 GetMappedFilename</a>
    </h2>
    
  <h5>April 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/api/">API</a>, 
      <a href="/tags/getmappedfilename/">GetMappedFileName</a>
  </div>
  


    <p>Bellow code demonstrate our to retrieve both current and target process full image path. This technique is very uncommon but works perfectly.
Notice for both techniques you muse translate its physical path to virtual path using this tiny function  // Jean-Pierre LESUEUR (@DarkCoderSc) function PhysicalToVirtualPath(APath : String) : String; var i : integer; ADrive : String; ABuffer : array[0..MAX_PATH-1] of Char; ACandidate : String; begin {$I-} for I := 0 to 25 do begin ADrive := Format('%s:', [Chr(Ord('A') + i)]); /// if (QueryDosDevice(PWideChar(ADrive), ABuffer, MAX_PATH) = 0) then continue; ACandidate := String(ABuffer).
        <a href="/docs/windows/snippets/delphi/get-process-name-method-2-getmappedfilename/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-1/">Get Process Name Method 1</a>
    </h2>
    
  <h5>March 12, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/process-id/">Process Id</a>
  </div>
  


    <p>This one possible technique (through QueryFullProcessImageNameW) to get process image path from it id.
This example support Windows Vista to latest Windows version (Actually Windows 10)
I will cover other example progressively and compatible with Windows XP and below.
// Jean-Pierre LESUEUR (@DarkCoderSc) //... uses Windows, SysUtils; //... function GetProcessName(AProcessID : Cardinal) : String; var hProc : THandle; ALength : DWORD; hDLL : THandle; QueryFullProcessImageNameW : function( AProcess: THANDLE; AFlags: DWORD; AFileName: PWideChar; var ASize: DWORD): BOOL; stdcall; const PROCESS_QUERY_LIMITED_INFORMATION = $00001000; begin result := ''; /// if (TOSVersion.
        <a href="/docs/windows/snippets/delphi/get-process-name-method-1/">...</a>
      
    </p>
  </article>
  

  


 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












