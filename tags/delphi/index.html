<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=""><meta property="og:title" content="Delphi" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.phrozen.io/tags/delphi/" />
<meta property="og:updated_time" content="2020-04-13T18:35:13+02:00" />
<title>Delphi | Phrozen</title>
<link rel="icon" href="/images/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/book.min.63abd10f627a7a06406140610b7ce76d028552de10d790fcb09f332349c39047.css" integrity="sha256-Y6vRD2J6egZAYUBhC3znbQKFUt4Q15D8sJ8zI0nDkEc=">
<script defer src="/en.search.min.aea1624c40d84692e310fe60cb07f8acd6eaf0c4442b21c8e24e3d326ad0d830.js" integrity="sha256-rqFiTEDYRpLjEP5gywf4rNbq8MREKyHI4k49MmrQ2DA="></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-159560668-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<link rel="alternate" type="application/rss+xml" href="https://www.phrozen.io/tags/delphi/index.xml" title="Phrozen" />
<script src="https://kit.fontawesome.com/8da36c42cc.js" crossorigin="anonymous"></script>
  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/logo.svg" alt="Logo" /></a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
    <span>Microsoft Windows</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/windows/projects/" class="collapsed ">Projects</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/windows/snippets/" class="collapsed ">Snippets</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
    <span>Linux</span>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/linux/slae32/" class="collapsed ">SLAE32</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="" target="_blank" rel="noopener"><strong>
        Social Networks
      </strong></a>
  </li>
  
  <li>
    <a href="https://www.linkedin.com/in/jlesueur/" target="_blank" rel="noopener"><i class='fa fa-linkedin'></i>
        Linkedin
      </a>
  </li>
  
  <li>
    <a href="https://www.twitter.com/darkcodersc" target="_blank" rel="noopener"><i class='fa fa-twitter'></i>
        Twitter
      </a>
  </li>
  
  <li>
    <a href="" target="_blank" rel="noopener"><strong>
        Other Stuff
      </strong></a>
  </li>
  
  <li>
    <a href="/disclaimer/disclaimer" target="_blank" rel="noopener">
        Legal
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Delphi</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
 
      </header>

      
      
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-registry-key-security-descriptor/">Get Registry Key DACL Security Descriptor</a>
    </h2>
    


  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/access/">Access</a>, 
      <a href="/tags/acl/">ACL</a>, 
      <a href="/tags/registry/">Registry</a>, 
      <a href="/tags/sddl/">SDDL</a>, 
      <a href="/tags/security-descriptor/">Security Descriptor</a>
  </div>
  


    <p>Below code snippet demonstrate how to get DACL Security Descriptor in SDDL format for a targeted registry key.
You need to parse the output SDDL string in order to understand access properties for desired keys, there are plenty of articles arround explaining how to understand an SDDL string format.
You can also play with flags associated to ConvertSecurityDescriptorToStringSecurityDescriptor call to extract even more information from captured Security Descriptor Pointer after RegGetKeySecurity call.
        <a href="/docs/windows/snippets/delphi/get-registry-key-security-descriptor/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-4-getprocessimagefilename/">Get Process Name Method 4 GetProcessImageFileName</a>
    </h2>
    
  <h5>April 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/getprocessimagefilename/">GetProcessImageFileName</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/windows-api/">Windows API</a>
  </div>
  


    <p>This time we will use a quite well known API to get the full process image path GetProcessImageFileName documented here.
Nothing very complex and this technique works from 32bit to 64bit / 64bit to 32bit processes.
// Jean-Pierre LESUEUR (@DarkCoderSc) function PhysicalToVirtualPath(APath : String) : String; var i : integer; ADrive : String; ABuffer : array[0..MAX_PATH-1] of Char; ACandidate : String; begin {$I-} for I := 0 to 25 do begin ADrive := Format('%s:', [Chr(Ord('A') + i)]); /// if (QueryDosDevice(PWideChar(ADrive), ABuffer, MAX_PATH) = 0) then continue; ACandidate := String(ABuffer).
        <a href="/docs/windows/snippets/delphi/get-process-name-method-4-getprocessimagefilename/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-3-ntqueryinformationprocess/">Get Process Name Method 3 NtQueryInformationProcess</a>
    </h2>
    
  <h5>April 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/windows-api/">Windows API</a>, 
      <a href="/tags/ntqueryinformationprocess/">NtQueryInformationProcess</a>
  </div>
  


    <p>Yet another technique to get the full image path of a target process using the NtQueryInformationProcess API documented Here
This technique from 32bit to 64bit / 64bit to 32bit.
// Jean-Pierre LESUEUR (@DarkCoderSc) function PhysicalToVirtualPath(APath : String) : String; var i : integer; ADrive : String; ABuffer : array[0..MAX_PATH-1] of Char; ACandidate : String; begin {$I-} for I := 0 to 25 do begin ADrive := Format('%s:', [Chr(Ord('A') + i)]); /// if (QueryDosDevice(PWideChar(ADrive), ABuffer, MAX_PATH) = 0) then continue; ACandidate := String(ABuffer).
        <a href="/docs/windows/snippets/delphi/get-process-name-method-3-ntqueryinformationprocess/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/enum-attached-files/">Enum Attached Files</a>
    </h2>
    
  <h5>March 24, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/windows/">Windows</a>, 
      <a href="/tags/attached-files/">Attached Files</a>, 
      <a href="/tags/enumerate/">Enumerate</a>, 
      <a href="/tags/open-files/">Open Files</a>, 
      <a href="/tags/open-handles/">Open Handles</a>
  </div>
  


    <p>Above snippet demonstrate how to enumerate files openned by running programs on Windows.
Some file unlocker use that technique to find where a specific file is attached and then force processes using that file to release it handle (via code injection techniques). I will write an example in a future snippet thread.
Notice: At the bottom of that page, you will see a concreate example about how to use that unit.
        <a href="/docs/windows/snippets/delphi/enum-attached-files/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-dll-exported-function-address-from-mem/">Get DLL Exported Function Address From Memory</a>
    </h2>
    
  <h5>March 18, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/alternative/">Alternative</a>, 
      <a href="/tags/dll/">DLL</a>, 
      <a href="/tags/exported-function/">Exported Function</a>, 
      <a href="/tags/getprocaddress/">GetProcAddress</a>, 
      <a href="/tags/memory/">Memory</a>
  </div>
  


    <p>As promised, we will adapt our previous code grab an exported function directly from memory.
Serious advantage of this technique:
 We don&rsquo;t have to use CreateToolHelp32Snapshot anymore to enumerate modules and catch target module base address. We don&rsquo;t need to parse PE Header from disk anymore, we will parse PE Header directly from memory.  Notice, it is still necessary to use LoadLibrary API to load desired DLL in memory.
        <a href="/docs/windows/snippets/delphi/get-dll-exported-function-address-from-mem/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/getprocaddress-alternative/">GetProcAddress API Alternative</a>
    </h2>
    
  <h5>March 14, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/alternative/">Alternative</a>, 
      <a href="/tags/export/">Export</a>, 
      <a href="/tags/getprocaddress/">GetProcAddress</a>, 
      <a href="/tags/loadlibrary/">LoadLibrary</a>, 
      <a href="/tags/pe-header/">PE Header</a>
  </div>
  


    <p>In the past two days, I released examples about how to enumerate DLL export table through the PE Header.
We will see one concreate example of using the UntEnumDLLExport.pas library to dynamically load API without using the famous Windows API &gt; GetProcAddress()
This technique is quite known and often used by some Malware, to mask which API&rsquo;s they are dynamically loading and avoid Antivirus detection.
To do so, we still need to use LoadLibrary() first to load a DLL in memory and retrieve it address, then iterate through loaded DLL export table and catch target function address.
        <a href="/docs/windows/snippets/delphi/getprocaddress-alternative/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/projects/opensource/dll-export-enum/">DLL Export Enum v1.0 (Open Source &#43; Signed Binary)</a>
    </h2>
    
  <h5>March 13, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/pe-header/">PE Header</a>, 
      <a href="/tags/dll-export/">DLL Export</a>, 
      <a href="/tags/enumerator/">Enumerator</a>, 
      <a href="/tags/functions/">Functions</a>, 
      <a href="/tags/list/">List</a>
  </div>
  


    <p>This project is mainly created to demonstrate how to use the previously released unit UntEnumDLLExport.pas available &gt; Here
The project is open source (see below for github link) and for those who don&rsquo;t have Delphi installed, you can download the compiled and code signed application (both 32 and 64bit).
Available Features  Enumerate Exported Functions From DLL.  Support Ordinal Value Only. Display Function Address and Relative Address. Support Forwarded Function.
        <a href="/docs/windows/projects/opensource/dll-export-enum/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/enum-dll-exported-functions/">Enum DLL Exported Functions</a>
    </h2>
    
  <h5>March 12, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/windows/">Windows</a>, 
      <a href="/tags/dll/">DLL</a>, 
      <a href="/tags/export/">Export</a>, 
      <a href="/tags/library/">Library</a>, 
      <a href="/tags/pe-header/">PE Header</a>, 
      <a href="/tags/exported-functions/">Exported Functions</a>
  </div>
  


    <p>This unit demonstrate how to enumerate DLL exported functions through PE Header manipulation.
Features  Support both 32 and 64bit DLL&rsquo;s. Identify exported function names. Identify exported function ordinal value. Support and resolve forwarded function. Identify export function address and relative address.  Unit Code (******************************************************************************* Author: -&gt; Jean-Pierre LESUEUR (@DarkCoderSc) https://github.com/DarkCoderSc https://gist.github.com/DarkCoderSc https://www.phrozen.io/ License: -&gt; MIT *******************************************************************************) unit UntEnumDLLExport; interface uses Classes, Windows, Generics.Collections, SysUtils; type TExportEntry = class private FName : String; FForwarded : Boolean; FForwardName : String; FRelativeAddr : Cardinal; FAddress : Int64; FOrdinal : Word; {@M} function GetFormatedAddress() : String; function GetFormatedRelativeAddr() : String; public {@C} constructor Create(); {@G/S} property Name : String read FName write FName; property Forwarded : Boolean read FForwarded write FForwarded; property ForwardName : String read FForwardName write FForwardName; property Address : Int64 read FAddress write FAddress; property RelativeAddr : Cardinal read FRelativeAddr write FRelativeAddr; property Ordinal : Word read FOrdinal write FOrdinal; {@G} property FormatedAddress : String read GetFormatedAddress; property FormatedRelativeAddress : String read GetFormatedRelativeAddr; end; TEnumDLLExport = class private FItems : TObjectList&lt;TExportEntry&gt;; FFileName : String; {@M} public {@C} constructor Create(AFileName : String); destructor Destroy(); override; {@M} function Enum() : Integer; {@G} property Items : TObjectList&lt;TExportEntry&gt; read FItems; property FileName : String read FFileName; end; implementation {+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Local Functions +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++} function IntToHexF(AValue : Int64; APad : Word = 0 {0=Auto}) : String; begin if (APad = 0) then begin if (AValue &lt;= High(Word)) then APad := 2 else if (AValue &lt;= High(DWORD)) and (AValue &gt; High(Word)) then APad := 8 else if (AValue &lt;= High(Int64)) and (AValue &gt; High(DWORD)) then APad := 16; end; result := '0x' + IntToHex(AValue, APad); end; {+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ TExportEntry +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++} constructor TExportEntry.
        <a href="/docs/windows/snippets/delphi/enum-dll-exported-functions/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/get-process-name-method-1/">Get Process Name Method 1</a>
    </h2>
    
  <h5>March 12, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/full-path/">Full Path</a>, 
      <a href="/tags/image-path/">Image Path</a>, 
      <a href="/tags/process-name/">Process Name</a>, 
      <a href="/tags/process-id/">Process Id</a>
  </div>
  


    <p>This one possible technique (through QueryFullProcessImageNameW) to get process image path from it id.
This example support Windows Vista to latest Windows version (Actually Windows 10)
I will cover other example progressively and compatible with Windows XP and below.
// Jean-Pierre LESUEUR (@DarkCoderSc) //... uses Windows, SysUtils; //... function GetProcessName(AProcessID : Cardinal) : String; var hProc : THandle; ALength : DWORD; hDLL : THandle; QueryFullProcessImageNameW : function( AProcess: THANDLE; AFlags: DWORD; AFileName: PWideChar; var ASize: DWORD): BOOL; stdcall; const PROCESS_QUERY_LIMITED_INFORMATION = $00001000; begin result := ''; /// if (TOSVersion.
        <a href="/docs/windows/snippets/delphi/get-process-name-method-1/">...</a>
      
    </p>
  </article>
  
  <article class="markdown book-post">
    <h2>
      <a href="/docs/windows/snippets/delphi/enum-modules-method-1/">Enum Modules Method 1</a>
    </h2>
    
  <h5>March 12, 2020</h5>



  

  
  <div>
    
      <a href="/tags/delphi/">Delphi</a>, 
      <a href="/tags/windows/">Windows</a>, 
      <a href="/tags/enumerate/">Enumerate</a>, 
      <a href="/tags/dll/">DLL</a>, 
      <a href="/tags/libraries/">Libraries</a>, 
      <a href="/tags/modules/">Modules</a>
  </div>
  


    <p>You will find below an example of how to enumerate process modules using the well known Windows API CreateToolHelp32Snapshot(), I will cover additional methods soon.
You may notice that when using CreateToolHelp32Snapshot(), first result (row) is generally the Image Path of the process owning module. I ignore that row by checking the value of szExePath with owner process image path.
GetProcessName() is compatible since Windows Vista. It is possible to support Windows XP and below but not in this example.
        <a href="/docs/windows/snippets/delphi/enum-modules-method-1/">...</a>
      
    </p>
  </article>
  

  

<ul class="pagination">
    
    <li class="page-item">
        <a href="/tags/delphi/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item disabled">
    <a  class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/tags/delphi/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/delphi/page/2/">2</a></li>
    
    
    <li class="page-item">
    <a href="/tags/delphi/page/2/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/tags/delphi/page/2/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












